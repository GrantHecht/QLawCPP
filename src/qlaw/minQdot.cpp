#include "qlaw.h"

double  minQdot(double  & sma, double  & e, double  & inc, double  & ape, double  & ran, double  & tru, double  & f, options * probdata)
{
	double  Qdot_n;

	static double  g109;
	static double  g110;
	static double  g2;
	static double  g3;
	static double  g4;
	static double  g5;
	static double  g6;
	static double  g7;
	static double  g8;
	static double  g9;
	static double  g10;
	static double  g11;
	static double  g13;
	static double  g14;
	static double  g15;
	static double  g12;
	static double  g17;
	static double  g18;
	static double  g19;
	static double  g24;
	static double  g25;
	static double  g26;
	static double  g27;
	static double  g28;
	static double  g16;
	static double  g20;
	static double  g32;
	static double  g21;
	static double  g22;
	static double  g23;
	static double  g29;
	static double  g30;
	static double  g31;
	static double  g33;
	static double  g36;
	static double  g34;
	static double  g35;
	static double  g37;
	static double  g38;
	static double  g39;
	static double  g40;
	static double  g41;
	static double  g46;
	static double  g42;
	static double  g43;
	static double  g44;
	static double  g45;
	static double  g47;
	static double  g48;
	static double  g49;
	static double  g50;
	static double  g51;
	static double  g53;
	static double  g52;
	static double  g54;
	static double  g55;
	static double  g56;
	static double  g57;
	static double  g58;
	static double  g65;
	static double  g59;
	static double  g60;
	static double  g61;
	static double  g62;
	static double  g66;
	static double  g63;
	static double  g64;
	static double  g67;
	static double  g68;
	static double  g69;
	static double  g70;
	static double  g71;
	static double  g72;
	static double  g73;
	static double  g74;
	static double  g75;
	static double  g78;
	static double  g76;
	static double  g77;
	static double  g79;
	static double  g114;
	static double  g80;
	static double  g81;
	static double  g82;
	static double  g83;
	static double  g84;
	static double  g85;
	static double  g86;
	static double  g87;
	static double  g88;
	static double  g89;
	static double  g90;
	static double  g91;
	static double  g92;
	static double  g93;
	static double  g94;
	static double  g95;
	static double  g100;
	static double  g101;
	static double  g96;
	static double  g97;
	static double  g98;
	static double  g99;
	static double  g102;
	static double  g103;
	static double  g104;
	static double  g105;
	static double  g106;
	static double  g107;
	static double  g108;
	static double  g111;
	static double  g112;
	static double  g113;
	static double  g115;
	static double  g116;
	static double  g117;
	static double  g118;
	static double  g119;
	static double  g120;
	static double  g121;
	static double  g122;
	static double  g123;
	static double  g124;
	static double  g128;
	static double  g125;
	static double  g126;
	static double  g127;
	static double  g129;
	static double  g130;
	static double  g131;
	static double  g132;
	static double  g133;
	static double  g178;
	static double  g134;
	static double  g135;
	static double  g136;
	static double  g137;
	static double  g138;
	static double  g139;
	static double  g140;
	static double  g141;
	static double  g220;
	static double  g142;
	static double  g144;
	static double  g145;
	static double  g146;
	static double  g147;
	static double  g148;
	static double  g149;
	static double  g150;
	static double  g151;
	static double  g152;
	static double  g153;
	static double  g154;
	static double  g155;
	static double  g156;
	static double  g157;
	static double  g158;
	static double  g159;
	static double  g160;
	static double  g161;
	static double  g162;
	static double  g163;
	static double  g164;
	static double  g165;
	static double  g166;
	static double  g167;
	static double  g168;
	static double  g169;
	static double  g170;
	static double  g171;
	static double  g172;
	static double  g173;
	static double  g174;
	static double  g175;
	static double  g176;
	static double  g177;
	static double  g179;
	static double  g180;
	static double  g181;
	static double  g182;
	static double  g183;
	static double  g184;
	static double  g185;
	static double  g186;
	static double  g187;
	static double  g188;
	static double  g189;
	static double  g190;
	static double  g191;
	static double  g192;
	static double  g193;
	static double  g194;
	static double  g195;
	static double  g196;
	static double  g197;
	static double  g198;
	static double  g199;
	static double  g200;
	static double  g201;
	static double  g202;
	static double  g203;
	static double  g204;
	static double  g205;
	static double  g206;
	static double  g207;
	static double  g208;
	static double  g209;
	static double  g210;
	static double  g211;
	static double  g212;
	static double  g213;
	static double  g214;
	static double  g215;
	static double  g216;
	static double  g217;
	static double  g218;
	static double  g219;
	static double  g221;
	static double  g222;
	static double  g223;
	static double  g143;
	static double  g224;
	static double  g225;
	static double  g226;
	static double  g227;

	//double  g109 = ape - probdata->ape_t;
	
	if (fmod(ape, 2.0*probdata->APPLE_PI) > fmod(probdata->ape_t, 2.0*probdata->APPLE_PI))
		g109 = fmod(ape - probdata->ape_t, 2.0*probdata->APPLE_PI) >  1.0e-6 ? fmod(ape - probdata->ape_t, 2.0*probdata->APPLE_PI) : 1.0e-6;
	else
		g109 = fmod(ape - probdata->ape_t, 2.0*probdata->APPLE_PI) < -1.0e-6 ? fmod(ape - probdata->ape_t, 2.0*probdata->APPLE_PI) : -1.0e-6;

	g110 = cos(g109);
	g2 = acos(g110);
	g3 = e*e;
	g4 = g3 - 1.0;
	g5 = 1.0 / (e*e*e);
	g6 = 1.0 / (e*e*e*e*e*e);
	g7 = g4*g4;
	g8 = g6*g7*(1.0 / 4.0);
	g9 = g8 + 1.0 / 2.7E1;
	g10 = sqrt(g9);
	g11 = 1.0 / e;
	g13 = g4*g5*(1.0 / 2.0);
	g14 = g10 + g13;
	g15 = pow(g14, 1.0 / 3.0);
	g12 = g11 + g15 - pow(g10 - g4*g5*(1.0 / 2.0), 1.0 / 3.0);
	g17 = g10 - g13;
	g18 = pow(g17, 1.0 / 3.0);
	g19 = g11 + g15 - g18;
	g24 = sma*g4;
	g25 = e*g19;
	g26 = g25 - 1.0;
	g27 = 1.0 / g26;
	g28 = sma*g4*g27;
	g16 = g24 - g28;
	g20 = cos(ape);
	g32 = probdata->mu*sma*g4;
	g21 = 1.0 / sqrt(-g32);
	g22 = probdata->b_petro + 1.0;
	g23 = g19*g19;
	g29 = g16*g16;
	g30 = sma*sma;
	g31 = g7*g23*g30;
	g33 = g23 - 1.0;
	g36 = g29*g33;
	g34 = g31 - g36;
	g35 = sqrt(g34);
	g37 = 1.0 / (e*e);
	g38 = 1.0 / sqrt(g9);
	g39 = 1.0 / (e*e*e*e*e);
	g40 = g4*g39;
	g41 = 1.0 / (e*e*e*e*e*e*e);
	g46 = g7*g41*(3.0 / 2.0);
	g42 = g40 - g46;
	g43 = g38*g42*(1.0 / 2.0);
	g44 = 1.0 / (e*e*e*e);
	g45 = 1.0 / pow(g14, 2.0 / 3.0);
	g47 = g4*g44*(3.0 / 2.0);
	g48 = 1.0 / pow(g17, 2.0 / 3.0);
	g49 = -g37 + g43 + g47;
	g50 = g48*g49*(1.0 / 3.0);
	g51 = g37 + g43 - g47;
	g53 = g45*g51*(1.0 / 3.0);
	g52 = g37 + g50 - g53;
	g54 = cos(inc);
	g55 = fabs(g54);
	g56 = sin(inc);
	g57 = 1.0 / g56;
	g58 = g20*g20;
	g65 = g3*g58;
	g59 = -g65 + 1.0;
	g60 = sqrt(g59);
	g61 = sin(ape);
	g62 = fabs(g61);
	g66 = e*g62;
	g63 = g60 - g66;
	g64 = 1.0 / g63;
	g67 = 1.0 / pow(-g32, 3.0 / 2.0);
	g68 = 1.0 / (f*f);
	g69 = sma - probdata->sma_t;
	g70 = 1.0 / sma;
	g71 = e - probdata->e_t;
	g72 = 1.0 / g4;
	g73 = inc - probdata->inc_t;
	g74 = fabs(g20);
	g75 = g61*g61;
	g78 = g3*g75;
	g76 = -g78 + 1.0;
	g77 = 1.0 / (g4*g4);
	g79 = sqrt(g76);
	g114 = e*g74;
	g80 = g79 - g114;
	g81 = g73*g73;
	g82 = 1.0 / (sma*sma*sma);
	g83 = g69*g69;
	g84 = e - 1.0;
	g85 = e + 1.0;
	g86 = fabs(g69);
	g87 = fabs(probdata->m_petro);
	g88 = 1.0 / g87;
	g89 = fabs(probdata->sma_t);
	g90 = 1.0 / g89;
	g91 = g86*g88*g90;
	g92 = pow(g91, probdata->n_petro);
	g93 = g92 + 1.0;
	g94 = 1.0 / probdata->r_petro;
	g95 = pow(g93, g94);


	//double  g100 = ran-probdata->ran_t;
	
	if (fmod(ran, 2.0*probdata->APPLE_PI) > fmod(probdata->ran_t, 2.0*probdata->APPLE_PI))
		g100 = fmod(ran - probdata->ran_t, 2.0*probdata->APPLE_PI) >  1.0e-6 ? fmod(ran - probdata->ran_t, 2.0*probdata->APPLE_PI) : 1.0e-6;
	else
		g100 = fmod(ran - probdata->ran_t, 2.0*probdata->APPLE_PI) < -1.0e-6 ? fmod(ran - probdata->ran_t, 2.0*probdata->APPLE_PI) : -1.0e-6;


	g101 = cos(g100);
	g96 = acos(g101);
	g97 = 1.0 / sqrt(g59);
	g98 = e*g58*g97;
	g99 = g62 + g98;
	g102 = g96*g96;
	g103 = g56*g56;
	g104 = 1.0 / probdata->rpermin;
	g105 = sma*g84*g104;
	g106 = g105 + 1.0;
	g107 = probdata->k_petro*g106;
	g108 = exp(g107);
	g111 = g2*g2;
	g112 = g22*g22;
	g113 = g71*g71;
	g115 = g80*g80;
	g116 = g63*g63;
	g117 = 1.0 / g85;
	g118 = cos(tru);
	g119 = e*g118;
	g120 = g119 + 1.0;
	g121 = 1.0 / g120;
	g122 = probdata->Wp*g108;
	g123 = g122 + 1.0;
	g124 = f*g11*g21*g35;
	g128 = probdata->b_petro*f*sma*g4*g21*g55*g57*g64;
	g125 = g124 - g128;
	g126 = 1.0 / sqrt(g34);
	g127 = 1.0 / (sma*sma);
	g129 = 1.0 / (g125*g125);
	g130 = probdata->We*probdata->mu*g68*g70*g72*g113*(1.0 / 4.0);
	g131 = probdata->Winc*probdata->mu*g68*g70*g72*g81*g115;
	g132 = probdata->Wran*probdata->mu*g68*g70*g72*g102*g103*g116;
	g133 = probdata->Wsma*probdata->mu*g68*g82*g83*g84*g95*g117*(1.0 / 4.0);
	g178 = probdata->Wape*g111*g112*g129;
	g134 = g130 + g131 + g132 + g133 - g178;
	g135 = sma*g4*g121;
	g136 = g24 + g135;
	g137 = 1.0 / sqrt(g76);
	g138 = 1.0 / (g63*g63);
	g139 = 1.0 / (g125*g125*g125);

	//double  g140 = (g61 / fabs(g61));
	g140 = g61 > 0.0 ? 1.0 : -1.0;

	g141 = e*g20*g140;
	g220 = g3*g20*g61*g97;
	g142 = g141 - g220;
	g144 = sin(tru);
	g145 = f*g21*g35*g37;
	g146 = f*probdata->mu*sma*g35*g67;
	g147 = g19*g29*g52*2.0;
	g148 = e*sma*2.0;
	g149 = e*sma*g27*2.0;
	g150 = 1.0 / (g26*g26);
	g151 = e*g52;
	g152 = g11 + g15 - g18 - g151;
	g153 = sma*g4*g150*g152;
	g154 = g148 - g149 + g153;
	g155 = g16*g33*g154*2.0;
	g156 = g7*g19*g30*g52*2.0;
	g157 = e*g4*g23*g30*4.0;
	g158 = g147 - g155 - g156 + g157;
	g159 = f*g11*g21*g126*g158*(1.0 / 2.0);
	g160 = probdata->b_petro*e*f*sma*g21*g55*g57*g64*2.0;
	g161 = probdata->b_petro*f*sma*g4*g21*g55*g57*g99*g138;
	g162 = probdata->b_petro*e*f*probdata->mu*g4*g30*g55*g57*g64*g67;
	g163 = g145 - g146 - g159 + g160 + g161 + g162;
	g164 = e*2.0;
	g165 = probdata->e_t*2.0;
	g166 = g164 - g165;
	g167 = probdata->We*probdata->mu*g68*g70*g72*g166*(1.0 / 4.0);
	g168 = probdata->Wsma*probdata->mu*g68*g82*g83*g95*g117*(1.0 / 4.0);
	g169 = probdata->We*e*probdata->mu*g68*g70*g77*g113*(1.0 / 2.0);
	g170 = e*g75*g137;
	g171 = g74 + g170;
	g172 = probdata->Winc*probdata->mu*g68*g70*g72*g80*g81*g171*2.0;
	g173 = probdata->Winc*e*probdata->mu*g68*g70*g77*g81*g115*2.0;
	g174 = 1.0 / (g85*g85);
	g175 = probdata->Wsma*probdata->mu*g68*g82*g83*g84*g95*g174*(1.0 / 4.0);
	g176 = probdata->Wran*probdata->mu*g63*g68*g70*g72*g99*g102*g103*2.0;
	g177 = probdata->Wran*e*probdata->mu*g68*g70*g77*g102*g103*g116*2.0;
	g179 = probdata->Wp*probdata->k_petro*sma*g104*g108*g134;
	g180 = sma*g7*g23*2.0;
	g181 = g4*g27;
	g182 = -g3 + g181 + 1.0;
	g183 = g16*g33*g182*2.0;
	g184 = g180 + g183;
	g185 = f*g11*g21*g126*g184*(1.0 / 2.0);
	g186 = f*probdata->mu*g4*g11*g35*g67*(1.0 / 2.0);
	g187 = probdata->b_petro*f*g4*g21*g55*g57*g64;
	g188 = probdata->b_petro*f*probdata->mu*sma*g7*g55*g57*g64*g67*(1.0 / 2.0);
	g189 = g185 + g186 - g187 - g188;
	g190 = probdata->Wape*g111*g112*g139*g189*2.0;
	g191 = probdata->We*probdata->mu*g68*g72*g113*g127*(1.0 / 4.0);
	g192 = probdata->Winc*probdata->mu*g68*g72*g81*g115*g127;
	g193 = probdata->Wran*probdata->mu*g68*g72*g102*g103*g116*g127;
	g194 = sma*2.0;
	g195 = probdata->sma_t*2.0;
	g196 = g194 - g195;
	g197 = probdata->Wsma*probdata->mu*g68*g82*g84*g95*g117*g196*(1.0 / 4.0);
	g198 = 1.0 / (sma*sma*sma*sma);
	g199 = probdata->Wsma*probdata->mu*g68*g83*g84*g95*g117*g198*(3.0 / 4.0);

	//double  g200 = (g69 / fabs(g69));
	g200 = g69 > 0.0 ? 1.0 : -1.0;

	g201 = g94 - 1.0;
	g202 = pow(g93, g201);
	g203 = probdata->n_petro - 1.0;
	g204 = pow(g91, g203);
	g205 = probdata->Wsma*probdata->mu*probdata->n_petro*g68*g82*g83*g84*g88*g90*g94*g117*g200*g202*g204*(1.0 / 4.0);
	g206 = -g190 + g191 + g192 + g193 - g197 + g199 - g205;
	g207 = g123*g206;
	g208 = probdata->Wp*probdata->k_petro*g84*g104*g108*g134;
	g209 = g207 - g208;
	g210 = sin(g109);
	g211 = g110*g110;
	g212 = -g211 + 1.0;
	g213 = 1.0 / sqrt(g212);
	g214 = probdata->Wape*g2*g112*g129*g210*g213*2.0;


	//double  g215 = (g20 / fabs(g20));
	g215 = g20 > 0.0 ? 1.0 : -1.0;

	g216 = e*g61*g215;
	g217 = g3*g20*g61*g137;
	g218 = g216 - g217;
	g219 = probdata->Winc*probdata->mu*g68*g70*g72*g80*g81*g218*2.0;
	g221 = probdata->Wran*probdata->mu*g63*g68*g70*g72*g102*g103*g142*2.0;
	g222 = probdata->Wape*probdata->b_petro*f*sma*g4*g21*g55*g57*g111*g112*g138*g139*g142*2.0;
	g223 = g214 - g219 + g221 + g222;
	g143 = -g21*(g118*g136 + e*sma*g4*g121)*(g179 - g123*(-g167 - g168 + g169 + g172 + g173 + g175 + g176 + g177 + probdata->Wape*g111*g112*g163*1.0 / pow(f*g11*g21*sqrt(g31 - g29*(g12*g12 - 1.0)) - probdata->b_petro*f*sma*g4*g21*g55*g57*g64, 3.0)*2.0)) - g21*g30*g120*g209*2.0 + g11*g21*g123*g136*g144*g223;
	g224 = sma*g4*g21*g144*(g179 - g123*(-g167 - g168 + g169 + g172 + g173 + g175 + g176 + g177 + probdata->Wape*g111*g112*g139*g163*2.0)) + e*g21*g30*g144*g209*2.0 + sma*g4*g11*g21*g118*g123*g223;
	g225 = ape + tru;
	g226 = sin(g225);
	g227 = sma*g4*g21*g121*g123*cos(g225)*(probdata->Wape*g111*g112*g139*(probdata->b_petro*f*sma*g4*g21*g64*((g54 / fabs(g54))) + probdata->b_petro*f*sma*g4*g21*g54*g55*1.0 / (g56*g56)*g64)*2.0 + probdata->Winc*probdata->mu*g68*g70*g72*g115*(inc*2.0 - probdata->inc_t*2.0) + probdata->Wran*probdata->mu*g54*g56*g68*g70*g72*g102*g116*2.0) + sma*g4*g21*g54*g57*g121*g123*g223*g226 + probdata->Wran*probdata->mu*g21*g56*g68*g96*g116*g121*g123*g226*sin(g100)*1.0 / sqrt(-g101*g101 + 1.0)*2.0;
	
	Qdot_n = -g143*g143 - g224*g224 - g227*g227;

	//Check for NaN's.....you probably want to end the simulation at this point
	if (Qdot_n != Qdot_n)
	{
		std::cout << "BLOW UP in effectivity!!" << std::endl;

		throw 13;
	}

	return Qdot_n;
}